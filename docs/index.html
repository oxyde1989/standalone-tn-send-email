<!doctype html>
<html lang="it" data-bs-theme="auto">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Oxyde Standalone SendEmail </title>
    <meta name="description" content="Guide and reference for the correct use of the SendEmail" />
    <meta property="og:url" content="https://oxyde1989.github.io/standalone-tn-send-email/" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/guidelines_preview.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text y='14' font-size='14'>üì¨</text></svg>">

    <style>
      :root { --hero-gradient: linear-gradient(135deg, #0d6efd 0%, #14A44D 100%); }
      .hero {
        background: var(--hero-gradient);
        color: #fff;
        border-radius: 1.25rem;
        padding: 1.5rem 0.7rem;
      }
      .hero .btn { box-shadow: 0 0.5rem 1rem rgba(0,0,0,.15); }
      .section-spacer { padding-top: 4rem; margin-top: -4rem; }
      .code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        background: var(--bs-tertiary-bg);
        border-radius: .75rem;
        padding: 1rem;
      }
      footer { border-top: 1px solid var(--bs-border-color); }
      .small-img-round {
        width: 30px;
        border-radius: 25px;
      }
      .img-thumbnail {
        max-width: 200px;;
      }
      ul li + li {
        margin-top: 3px;
        margin-bottom: 3px;
      }  
    ul.mpr li + li {
      margin-top: 10px;
      margin-bottom: 10px;
    }      
      
    </style>
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary sticky-top border-bottom">
      <div class="container">
        <span  class="navbar-brand d-flex align-items-center gap-2" href="#">
          <span class="fs-5">üì¨</span>
          <strong>Standalone SendEmail V1.70</strong>
        </span >
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="nav">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="https://github.com/oxyde1989/standalone-tn-send-email">Go to the Project</a></li>
            <li class="nav-item" style="display:none"><a class="nav-link" href="https://github.com/oxyde1989?tab=repositories">Other personal works</a></li>
          </ul>
          <div class="ms-lg-3 d-flex gap-2">
            <div class="btn-group" role="group" aria-label="Theme">
              <button class="btn btn-outline-secondary btn-sm" data-theme-value="light" title="light Theme">‚òÄÔ∏è</button>
              <button class="btn btn-outline-secondary btn-sm" data-theme-value="dark" title="dark Theme">üåô</button>
              <button class="btn btn-outline-secondary btn-sm" data-theme-value="auto" title="auto Theme">üñ•Ô∏è</button>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <header class="container my-4" id="top" >
      <div class="hero text-center">
        <h1 class="display-5 fw-bold mb-3">SendEmail Official Guidelines</h1>
        <p class="lead mb-4" style="display: none">This standalone script provides the ability to send emails and attachments using the TrueNAS native mail.config, in the simplest possible way for the end user</p>
      </div>
    </header>

    <main class="container my-5">
      <div class="row g-4">
        <div class="col-lg-10">

          <section id="introduction" class="section-spacer mb-4">
            <h2 class="h3 mb-3">About the project</h2>
            <div class="accordion" id="acc-intro">
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-intro-1">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-intro-1" aria-expanded="false" aria-controls="c-intro-1">
                    üìå What this script do
                  </button>
                </h2>
                <div id="c-intro-1" class="accordion-collapse collapse" aria-labelledby="h-intro-1" data-bs-parent="#acc-intro">
                  <div class="accordion-body">
                    Starting from TrueNAS 24.10.10, the sendemail builtin function is no longer available (removed for security reason).<br>
                    The <code>mail.send</code> method is still available, but is quite trivial to use due to some payload limitations/encoding/ecc.<br>
                    This standalone script provides the ability to send emails and attachments using the TrueNAS native <code>mail.config</code>, in the simplest possible way, without giving up on some more advanced features that are not natively available.<br>
                    Originally designed to be a wrapper for <a href="https://github.com/JoeSchmuck/Multi-Report/tree/main" target="blank">Joe's Multi Report</a>, it also can be used to simplify sending email overall in many other scenarios.
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-intro-2">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-intro-2" aria-expanded="false" aria-controls="c-intro-2">
                    ‚öôÔ∏è How it works
                  </button>
                </h2>
                <div id="c-intro-2" class="accordion-collapse collapse" aria-labelledby="h-intro-2" data-bs-parent="#acc-intro">
                  <div class="accordion-body">
                        Actually, there are basically 2 different usage methods:
                        <ul>
                            <li>Passing <code>--subject</code>, <code>--to_address</code>, <code>--mail_body_html</code> (either a file path and plain text), plus other optionally args explained belove.</li>
                            <li>Passing only the full email base64 encoded (either a file path and plain text) as <code>--mail_bulk</code>, trying to emulating the old sendemail function, and all the info will be retrieved there.</li>
                        </ul> 
                        Check the <a href="#advanced" class="btn btn-sm btn-primary">Advanced usage methods</a> section for more details!                          
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-intro-3">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-intro-3" aria-expanded="false" aria-controls="c-intro-3">
                    ‚úîÔ∏è Requirements
                  </button>
                </h2>
                <div id="c-intro-3" class="accordion-collapse collapse" aria-labelledby="h-intro-3" data-bs-parent="#acc-intro">
                  <div class="accordion-body">
                      <ul>
                        <li>Truenas Scale <b>stable</b> train (nightly, alpha, beta, ... are not officially supported)</li>
                        <li>Truenas Core is also supported, with some minor limitation</li>
                        <li>Working internet connection</li>
                        <li>Working email settings in Truenas (System ‚ûú General Settings ‚ûú Email)</li>
                        <li>Context usage user with at least <code>READONLY_ADMIN</code> or <code>SHARING_ADMIN</code> roles</li>
                        <li>Context usage user with enough permissions on the execution folder</li>
                        <li>The script should reside in a <strong>secured dataset/folder</strong></li>
                      </ul>
                  </div>
                </div>
              </div>                  
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-intro-4">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-intro-4" aria-expanded="false" aria-controls="c-intro-4">
                    üîê Security Concern
                  </button>
                </h2>
                <div id="c-intro-4" class="accordion-collapse collapse" aria-labelledby="h-intro-4" data-bs-parent="#acc-intro">
                  <div class="accordion-body">
                        To retrieve TN mail configuration data, at least <code>READONLY_ADMIN</code> or <code>SHARING_ADMIN</code> roles are needed for the user running the script.<br>
                        <b>So is highly advised to only use the script in a secured folder, not accessible to un-priviliged users, to avoid unexpected behaviour.</b><br>
                        The script will advise you in those scenarios, so pay attention if some warning are raised on first usage and fix your dataset permission accordingly. <br>
                        There are other checks performed to improve security (attachment black list, avoiding symlink, CRLF injection, ...), any suggestiona are welcome and i will do my best to keep things as safe and flexible for everyone.                         
                  </div>
                </div>
              </div>              
            </div>
          </section>

          <section id="advanced" class="section-spacer mb-4">
            <h2 class="h3 mb-3">Advanced usage methods</h2>
            <div class="accordion" id="acc-inst">
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-inst-1">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-inst-1" aria-expanded="false" aria-controls="c-inst-1">
                    ‚úâÔ∏è Sender data override
                  </button>
                </h2>
                <div id="c-inst-1" class="accordion-collapse collapse" aria-labelledby="h-inst-1" data-bs-parent="#acc-inst">
                  <div class="accordion-body">
                    Is possible to override the default TN sender name - sender email to fit more scenarios in those ways:
                    <ul>
                        <li>
                            using directly <code>--override_fromemail</code> or <code>--override_fromname</code> args calling the script
                        </li>
                        <li>
                            for multi report users, editing own standard <code>mr_config file</code>, value involved are <code>FromName</code> and <code>From</code>, as a fallback
                        </li>
                    </ul>
                    üìå The priority is: <code> override data > fallback data > default </code><br><br>
                    <i>If sendemail and <code>mr_config file</code> are in the same folder, fallback values will be still retrieved although you will call the script outside the multi_report.</i><br>
                    Also to mention, only <code>override_fromname</code> and <code>FromName</code> can be used, without an email override, and they will be applied to the default TN email.<br><br>
                    <strong>Customize the sender name has no particoular restrictions, is pretty safe, instead you have to pay attention on customizing the sender (reject ratio depending on your provider):</strong>
                    <ul class="mpr">
                        <li><img alt="GMAIL" src="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/gmail.png" class="small-img-round">
                          <strong>GMAIL:</strong> this provider will override your sender with the account email if it is not a validated alias, and the deliver shouldn't fail; you can safely send email with a sender plus address (example, your account is myemail@gmail.com and you use myemail+multireport@gmail.com as sender) </li>
                        <li><img alt="OUTLOOK" src="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/outlook.png" class="small-img-round">
                          <strong>OUTLOOK:</strong> every sender that is not a valid alias of the account will be rejected </li>
                        <li><img alt="SMTP" src="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/smtp.png" class="small-img-round">
                          <strong>SMTP:</strong> every provider has own policy, but the most reject sender that is not a validated account/alias; also to mention, despite the email is send, using a sender with a different domain can be checked as spoofing with the direct conseguence that the email is delivered but go into the SPAM folder </li>                    
                    </ul>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-inst-2">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-inst-2" aria-expanded="false" aria-controls="c-inst-2">
                    üêû Debugging
                  </button>
                </h2>
                <div id="c-inst-2" class="accordion-collapse collapse" aria-labelledby="h-inst-2" data-bs-parent="#acc-inst">
                  <div class="accordion-body">
                    In case of need, passing <code>--debug_enabled</code> as arg to the script will activate the debug mode: a log file will be generated and placed into <code>sendemail_log</code> folder. <br>
                    Folder itself and files can be safely deleted manually anytime the script is not running.<br>
                    Calling the script from crontab, with the debug enabled, can lead to problem if the root user is the one used and, before invoke the script, the correct working directory is not selected with a <code>cd</code> command.<br>
                    Log files not obviously expose credentials or access token, but don't forget to cleanup after a debug session anyway to not expose more-or-less sensitive data in your usage context arising from exceptions.
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-inst-3">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-inst-3" aria-expanded="false" aria-controls="c-inst-3">
                    üöß Test mode
                  </button>
                </h2>
                <div id="c-inst-3" class="accordion-collapse collapse" aria-labelledby="h-inst-3" data-bs-parent="#acc-inst">
                  <div class="accordion-body">
                        If you wanna just test the basic function fast and quickly, use the <code>--test_mode</code> and the script will compose and send a test email to the actual user email address.<br>
                        In test mode, every arg will be overwritten, <b>also the debug will be enabled automatically</b>. 
                        If the script is in the same Multi Report folder, the fallback from the multi_report_config.txt <code>FromName</code> and <code>From</code> will be used, so you can ensure that the fallbacks are working properly.
                        <img alt="test preview" class="img-fluid" src="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/test_email.png">
                  </div>
                </div>
              </div>  
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-inst-4">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-inst-4" aria-expanded="false" aria-controls="c-inst-4">
                    üì± Prebuilt Template
                  </button>
                </h2>
                <div id="c-inst-4" class="accordion-collapse collapse" aria-labelledby="h-inst-4" data-bs-parent="#acc-inst">
                  <div class="accordion-body">
                        Prebuilt templates are a collection of email templates that allow user to fast "beautify" theyr email (with a nod to responsive design). <br>
                        They are also used for internal message like test email, update notification, ecc (but those are reserved, and can't be selected). <br>
                        Usage is pretty simple:
                        <ul>
                          <li> choose the template that fit your need from the preview list above (click the image for a bigger view)</li>
                          <li> grab the code and use it in the  <code>--use_template</code> arg calling the script</li>
                          <li> some templates, to work properly, will need a set of dynamic fields as json object in the <code>--template_var</code> arg. </li>
                          <li> attribute usage convention used is <code>*element*col</code> for <code>color</code>, <code>*element*bkcol</code> for <code>background-color</code>, <code>*element*content</code> for inner text, <code>*element*width</code> for <code>width</code></li>
                        </ul>
                       
                        <b style="color:#3B71CA">The list of available templates will be constantly updated!</b>                           
                    <!-- preview -->
                     <hr>
                     
                    <div class="table-responsive">
                      <table class="table align-middle">                      
                        <thead>
                          <tr>
                            <th style="width:160px;">Preview</th>
                            <th>Code</th>
                            <th>Notes</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>
                              <a href="#" data-bs-toggle="modal" data-bs-target="#tplPreviewModal"
                                data-full="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/previewtemplate/ut_default.png" data-title="UT_default">
                                <img src="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/previewtemplate/ut_default.png" alt="UT_default preview"
                                    class="img-thumbnail">
                              </a>
                            </td>
                            <td><code>UT_default</code></td>
                            <td>
                                Generic basic wrapper for subject (used in the header) and content (used in the body container).<br>
                                No dynamic fields are used/required, this is the best template to receive a responsive email without do anything fancy
                                <hr>
                                <code>--use_template "UT_default"</code>
                            </td>
                          </tr>

                          <tr>
                            <td>
                              <a href="#" data-bs-toggle="modal" data-bs-target="#tplPreviewModal"
                                data-full="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/previewtemplate/ut_default_adv.png" data-title="UT_default_adv">
                                <img src="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/previewtemplate/ut_default_adv.png" alt="UT_default_adv preview"
                                    class="img-thumbnail">
                              </a>
                            </td>
                            <td><code>UT_default_adv</code></td>
                            <td>Generic basic wrapper for subject and content, but with the possibility to customize style and header content. <br>
                                Some additional arguments are required as mapped belove:
                                <ul>
                                  <li>bkcol</li>
                                  <li>containerbkcol</li>
                                  <li>containerwidth</li>
                                  <li>headerbkcol</li>
                                  <li>headerbkcol</li>
                                  <li>headercol</li>
                                  <li>headercontent</li>
                                </ul>
                                The preview is build from those settings:
                                <hr>
                                <code>--use_template "UT_default_adv" 
                                  --template_var '{"bkcol": "#332D2D", "containerbkcol": "#FBFBFB", "containerwidth": "50%", "headerbkcol": "#3B71CA,#E4A11B", "containercol": "#DC4C64", "headercol": "#FFFFFF", "headercontent": "Template UT_default_adv"}'
                                </code>
                            </td>
                          </tr>  
                          
                          <tr>
                            <td>
                              <a href="#" data-bs-toggle="modal" data-bs-target="#tplPreviewModal"
                                data-full="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/previewtemplate/ut_table_4col.png" data-title="ut_table_4col">
                                <img src="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/previewtemplate/ut_table_4col.png" alt="ut_table_4col preview"
                                    class="img-thumbnail">
                              </a>
                            </td>
                            <td><code>ut_table_4col</code></td>
                            <td>
                                Generic basic wrapper to build a dynamic 4 column table, with subject on top and html_content on bottom.<br>
                                Access the col name with <code>col1 col2 col3 col4</code>, and iterate every line with an array named <code>containers</code> 
                                <hr>
                                <code>--use_template "ut_table_4col"
                                  --template_var '{"col1": "col1 name", "col2": "col2 name", "col3": "col3 name", "col4": "col4 name", "containers": [ {"col1": "col1 value", "col2": "col2 value", "col3": "col3 value", "col4": "col4 value"}, {"col1": "col1 value", "col2": "col2 value", "col3": "col3 value", "col4": "col4 value"}, ... ]}'


                                </code>
                            </td>
                          </tr>
                          
                          <tr>
                            <td>
                              <a href="#" data-bs-toggle="modal" data-bs-target="#tplPreviewModal"
                                data-full="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/previewtemplate/ut_table_5col.png" data-title="ut_table_5col">
                                <img src="https://raw.githubusercontent.com/oxyde1989/standalone-tn-send-email/main/assets/previewtemplate/ut_table_5col.png" alt="ut_table_5col preview"
                                    class="img-thumbnail">
                              </a>
                            </td>
                            <td><code>ut_table_5col</code></td>
                            <td>
                                Generic basic wrapper to build a dynamic 5 column table, with subject on top and html_content on bottom.<br>
                                Access the col name with <code>col1 col2 col3 col4 col5</code>, and iterate every line with an array named <code>containers</code> 
                                <hr>
                                <code>--use_template "ut_table_5col"
                                  --template_var '{"col1": "col1 name", "col2": "col2 name", "col3": "col3 name", "col4": "col4 name", "col5": "col5 name", "containers": [ {"col1": "col1 value", "col2": "col2 value", "col3": "col3 value", "col4": "col4 value", "col5": "col5 value"}, ... ]}'


                                </code>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div> <!-- end prev -->

                  </div>
                </div>
              </div>     
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-inst-5">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-inst-5" aria-expanded="false" aria-controls="c-inst-5">
                    üë®‚Äçüîß Build and use your Custom Template
                  </button>
                </h2>
                <div id="c-inst-5" class="accordion-collapse collapse" aria-labelledby="h-inst-5" data-bs-parent="#acc-inst">
                  <div class="accordion-body">
                        Advanced users can build theyr own custom templates following this steps: 
                        <ul>
                          <li>create a file in the same sendemail execution folder</li>
                          <li>fill up every dynamic fields you need with this sintax: <code>{myfieldname}</code></li>
                          <li>email subject is available as <code>{subject}</code>, and the html body as <code>{html_content}</code></li>
                          <li><b>be careful on escape single bracket on other part of the code:</b> they must be escaped with a double bracket, example: <code> .myclass { color: black;} ...</code> must be <code> .myclass {{ color: black;}} ...</code>, otherwhise the template will not be applied correctly</li>
                          <li>pass <code>--use_template "myfile.html"</code> and <code>--template_var</code> arg with all the dynamic fields you have created in the template <code>{"myfieldname": "myvalue" ...}</code></li>
                        </ul>
                        Quick example: <br>
                        <pre class="code mb-0"><code>python3 sendemail.py --use_template "myfile.html" --template_var '{"myfieldname": "myvalue", ...}' ...</code></pre>
                        Missing fields will be replaced as <code>[myfield]</code>                          
                  </div>
                </div>
              </div>    
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-inst-6">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-inst-6" aria-expanded="false" aria-controls="c-inst-6">
                    üìà How iterate items in templates
                  </button>
                </h2>
                <div id="c-inst-6" class="accordion-collapse collapse" aria-labelledby="h-inst-6" data-bs-parent="#acc-inst">
                  <div class="accordion-body">
                      <code>--template_var</code> is also capable to handle array of json object, for example 
                      <pre class="code mb-0"><code>{"myfieldname": "myvalue", "myarray": [ {"a_var1": "a_var1_value", "a_var2": "a_var2_value"}, {...}] ...}</code></pre>
                      if accompanied by this convention in the template (custom or prebuilt):
                      <pre class="code mb-0"><code>&lt;!-- #for var in myarray --&gt;  &lt;li&gt;{var[a_var1]} ‚Äî {var[a_var2]}&lt;/li&gt; &lt;!-- #endfor --&gt; </code></pre>
                      Every array element will be iterate and the var will be replaced accordingly!<br>
                      Note that <i>myarray</i> must coincide with the name of the array to work, and same for the json object property!<br>
                      Names are totally customizable, just respect the "html comment convention"!<br>
                      This trick will be very helpful to build dynamic table easily and fast: use all the array you want, but only one iteration will for once will be applied, <i>nested json arrays are not supported</i>.                     
                  </div>
                </div>
              </div>                              
              
            </div>
          </section>

          <section id="updates" class="section-spacer mb-5">
            <h2 class="h3 mb-3">Managing updates</h2>
            <div class="accordion" id="acc-faq">
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-faq-0">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-faq-0" aria-expanded="false" aria-controls="c-faq-0">
                    üî• Update Strategies
                  </button>
                </h2>
                <div id="c-faq-0" class="accordion-collapse collapse" aria-labelledby="h-faq-0" data-bs-parent="#acc-faq">
                  <div class="accordion-body">
                    From version 1.50, the sendemail has been equipped with several tools, that will help both end users and other scripts (that rely on sendemail) keep everything updated.<br>
                    These tools aim to ensure to keep things easy in different scenarios, providing notifications, outputs (that can be parsed), and an internal auto-update mechanism.
                  </div>
                </div>
              </div>                
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-faq-1">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-faq-1" aria-expanded="false" aria-controls="c-faq-1">
                    üì© Update Notification
                  </button>
                </h2>
                <div id="c-faq-1" class="accordion-collapse collapse" aria-labelledby="h-faq-1" data-bs-parent="#acc-faq">
                  <div class="accordion-body">
                    With <code>--notify_update</code> the script uses the TrueNAS builtin <code>mail.send</code> command to notify that a new version has been released.<br>
                    This arg is intended to be used alone in a TrueNAS cronjob, with a "slow" schedule (e.g. weekly, since it has no queue management) to help keep the script manually updated.<br>

                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-faq-2">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-faq-2" aria-expanded="false" aria-controls="c-faq-2">
                    üß≤ Update Checking
                  </button>
                </h2>
                <div id="c-faq-2" class="accordion-collapse collapse" aria-labelledby="h-faq-2" data-bs-parent="#acc-faq">
                  <div class="accordion-body">
                    With <code>--check_update</code> the script returns a tiny json object that other scripts can use to decide whether to perform or notify about an available update.<br>
                    This arg is intended to be used alone.
                    <pre class="code mb-0">{"version": "1.**", "latest_version": "1.**", "need_update": false} </pre>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-faq-3">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-faq-3" aria-expanded="false" aria-controls="c-faq-3">
                    üõ† Update Self
                  </button>
                </h2>
                <div id="c-faq-3" class="accordion-collapse collapse" aria-labelledby="h-faq-3" data-bs-parent="#acc-faq">
                  <div class="accordion-body">
                    With <code>--self_update</code> the script will perform an auto update, only if a new stable version is available on Github.<br>
                    This arg can be used with <code>--notify_self_update</code>, and the script will generate a notification using the TrueNAS builtin <code>mail.send</code> command, whether it a success or fail.<br>
                    Also to mention, everytime the <code>--self_update</code> is used, <strong>also the debug mode can be used!</strong>
                  </div>
                </div>
              </div>              
            </div>
          </section>

          <section id="usageexample" class="section-spacer mb-5">
            <h2 class="h3 mb-3">Usage example</h2>
            <div class="accordion" id="acc-usex">
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usex-0">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usex-0" aria-expanded="false" aria-controls="c-usex-0">
                    üîò TestMode: quick send testing
                  </button>
                </h2>
                <div id="c-usex-0" class="accordion-collapse collapse" aria-labelledby="h-usex-0" data-bs-parent="#acc-usex">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
python3 sendemail.py --test_mode</code> </pre>
                  </div>
                </div>
              </div>                
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usex-1">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usex-1" aria-expanded="false" aria-controls="c-usex-1">
                    üîò Send method 1 - filling basic args 
                  </button>
                </h2>
                <div id="c-usex-1" class="accordion-collapse collapse" aria-labelledby="h-usex-1" data-bs-parent="#acc-usex">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash 
subject='test' 
recipient='myemail@gmail.com'

# Email Body: can be an HTML file path or plain text/html
html_file="&#60;h1&#62;Send Email Test&#60;/h1&#62;&#60;p&#62;Hello World!&#60;/p&#62;"

# Attachments (optional): add file paths
attachment=() 
attachment+=("path/to/first/attachment")  # Replace with the actual path
#attachment+=("path/to/second/attachment") # Add additional files as needed

python3 sendemail.py \
    --subject "$subject" \
    --to_address "$recipient" \
    --mail_body_html "$html_file" \
    --attachment_files "${attachment[@]}"</code> </pre>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usex-2">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usex-2" aria-expanded="false" aria-controls="c-usex-2">
                    üîò Send method 2 - using bulk email
                  </button>
                </h2>
                <div id="c-usex-2" class="accordion-collapse collapse" aria-labelledby="h-usex-2" data-bs-parent="#acc-usex">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
mail_bulk= '/path/to/base64encode/email'
python3 sendemail.py --mail_bulk "$mail_bulk" </code></pre>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usex-3">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usex-3" aria-expanded="false" aria-controls="c-usex-3">
                    üîò Send method 1 - Using override
                  </button>
                </h2>
                <div id="c-usex-3" class="accordion-collapse collapse" aria-labelledby="h-usex-3" data-bs-parent="#acc-usex">
                  <div class="accordion-body">
                      <pre class="code mb-0">#!/bin/bash
subject='test' 
recipient='myemail@gmail.com'
html_file="&#60;h1&#62;Send Email Test&#60;/h1&#62;&#60;p&#62;Hello World!&#60;/p&#62;"

python3 sendemail.py \
    --subject "$subject" \
    --to_address "$recipient" \
    --mail_body_html "$html_file" \
    --override_fromname "Pippo" \
    --override_fromemail "myemail+pippo@gmail.com"</pre>
                  </div>
                </div>
              </div>  
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usex-4">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usex-4" aria-expanded="false" aria-controls="c-usex-4">
                    üîò Send method 1 - activating debug
                  </button>
                </h2>
                <div id="c-usex-4" class="accordion-collapse collapse" aria-labelledby="h-usex-4" data-bs-parent="#acc-usex">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
subject='test' 
recipient='myemail@gmail.com'
html_file="&#60;h1&#62;Send Email Test&#60;/h1&#62;&#60;p&#62;Hello World!&#60;/p&#62;"

python3 sendemail.py \
    --subject "$subject" \
    --to_address "$recipient" \
    --mail_body_html "$html_file" \
    --debug_enabled</code></pre>
                  </div>
                </div>
              </div>            
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usex-5">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usex-5" aria-expanded="false" aria-controls="c-usex-5">
                    üîò Update - get notification
                  </button>
                </h2>
                <div id="c-usex-5" class="accordion-collapse collapse" aria-labelledby="h-usex-5" data-bs-parent="#acc-usex">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
python3 sendemail.py --notify_update</code></pre>
                  </div>
                </div>
              </div>  
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usex-6">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usex-6" aria-expanded="false" aria-controls="c-usex-6">
                    üîò Update - self update with notification
                  </button>
                </h2>
                <div id="c-usex-6" class="accordion-collapse collapse" aria-labelledby="h-usex-6" data-bs-parent="#acc-usex">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
python3 sendemail.py --self_update --notify_self_update</code></pre>
                  </div>
                </div>
              </div>                              
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usex-7">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usex-7" aria-expanded="false" aria-controls="c-usex-7">
                    üîò Send method 1 - add basic wrapper template
                  </button>
                </h2>
                <div id="c-usex-7" class="accordion-collapse collapse" aria-labelledby="h-usex-7" data-bs-parent="#acc-usex">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
python3 sendemail.py \
    --subject "My subject" \
    --to_address "myemail@gmail.com" \
    --mail_body_html "&#60;h1&#62;Send Email Test&#60;/h1&#62;&#60;p&#62;Hello World!&#60;/p&#62;" \
    --use_template "UT_default"</code></pre>
                  </div>
                </div>
              </div>   
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usex-8">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usex-8" aria-expanded="false" aria-controls="c-usex-8">
                    üîò Send method 1 - add modified basic wrapper template
                  </button>
                </h2>
                <div id="c-usex-8" class="accordion-collapse collapse" aria-labelledby="h-usex-8" data-bs-parent="#acc-usex">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
python3 sendemail.py \
    --subject "My subject" \
    --to_address "myemail@gmail.com" \
    --mail_body_html "&#60;h1&#62;Send Email Test&#60;/h1&#62;&#60;p&#62;Hello World!&#60;/p&#62;" \
    --use_template "UT_default_adv" \
    --template_var '{
    "bkcol": "#fff5f5", 
    "containerbkcol": "#ffffff",
    "containerwidth": "50%",
    "headerbkcol": "#dc2626,#b91c1c",
    "containercol": "#1f2937",
    "headercol": "#000000",
    "headercontent": "My message header"
  }'</code></pre>
                  </div>
                </div>
              </div>  
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usex-9">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usex-9" aria-expanded="false" aria-controls="c-usex-9">
                    üîò Send method 1 - with custom wrapper template
                  </button>
                </h2>
                <div id="c-usex-9" class="accordion-collapse collapse" aria-labelledby="h-usex-9" data-bs-parent="#acc-usex">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
python3 sendemail.py \
    --subject "My subject" \
    --to_address "myemail@gmail.com" \
    --mail_body_html "&#60;h1&#62;{fieldkey1} Test&#60;/h1&#62;&#60;p&#62;Hello World! {fieldkey2} {fieldkey3}&#60;/p&#62;" \
    --use_template "mycustomtemplate.html" \
    --template_var '{
    "fieldkey1":"fieldvalue1"
    , "fieldkey2":"fieldvalue2"
    , "fieldkey3":"fieldvalue2"
  }'</code></pre>
                  </div>
                </div>
              </div>  

              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usex-10">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usex-10" aria-expanded="false" aria-controls="c-usex-10">
                    üîò Send method 1 - with custom wrapper template and iterate items
                  </button>
                </h2>
                <div id="c-usex-10" class="accordion-collapse collapse" aria-labelledby="h-usex-10" data-bs-parent="#acc-usex">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
python3 sendemail.py \
    --subject "My subject {fieldkey3}" \
    --to_address "myemail@gmail.com" \
    --mail_body_html "&#60;h1&#62;{fieldkey1} Test&#60;/h1&#62;&#60;p&#62;Hello World! {fieldkey2} {fieldkey3}&#60;/p&#62;" \
    --use_template "mycustomtemplatewithiterate.html" \
    --template_var '{
    "fieldkey1":"fieldvalue1"
    , "fieldkey2":"fieldvalue2"
    , "fieldkey3":"fieldvalue2"
    , "pluto": [
      {"fldv":"1", "fldv2":"2"}
      , {"fldv":"3", "fldv2":"4"}
    ]    
  }'</code>
  <code>
    #mycustomtemplatewithiterate.html
    &lt;h1&gt;{fieldkey1} - {fieldkey2}&lt;/h1&gt;
    &lt;ul&gt;
  &lt;!-- #for pippo in pluto --&gt;
    &lt;li&gt;{pippo[fldv]} ‚Äî {pippo[fldv2]}&lt;/li&gt;
  &lt;!-- #endfor --&gt;
    &lt;/ul&gt;
  </code>
</pre>
                  </div>
                </div>
              </div>                

            </div>
          </section>

          <section id="usefullsnipplet" class="section-spacer mb-5">
            <h2 class="h3 mb-3">Usefull snipplet</h2>
            <div class="accordion" id="acc-usef">

              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usef-0">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usef-0" aria-expanded="false" aria-controls="c-usef-0">
                    üî∑ Get an essential TN App Report
                  </button>
                </h2>
                <div id="c-usef-0" class="accordion-collapse collapse" aria-labelledby="h-usef-0" data-bs-parent="#acc-usef">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
python3 sendemail_BETA.py \
    --subject &quot;üî∑ App Report&quot; \
    --to_address &quot;replaceme@email.com&quot; \
    --mail_body_html &quot;&amp;nbsp;&quot; \
    --use_template &quot;UT_table_5col&quot; \
--template_var &quot;$(
midclt call app.query | jq -c &#39;{ 
  col1:&quot;&amp;nbsp;&quot;, col2:&quot;App&quot;, col3:&quot;State&quot;, col4:&quot;Version&quot;, col5:&quot;Upgrade Available&quot;,
  containers: map({
    col1: ( 
      (.metadata.icon // &quot;&quot;) 
      | if length&gt;0 
        then (&quot;&lt;img src=\&quot;&quot; + . + &quot;\&quot; alt=\&quot;icon\&quot; style=\&quot;width:30px;vertical-align:middle\&quot;&gt;&quot;)
        else &quot;-&quot; 
        end
      ),
    col2: (.name // &quot;-&quot;),
    col3: (.state // &quot;-&quot;),
    col4: (.human_version // &quot;-&quot;),
    col5: (.upgrade_available // &quot;-&quot;)
  })
}&#39;

)

</code> </pre>
                  </div>
                </div>
              </div>       

              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usef-1">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usef-1" aria-expanded="false" aria-controls="c-usef-1">
                    üê≥ Get a detailed docker containers report
                  </button>
                </h2>
                <div id="c-usef-1" class="accordion-collapse collapse" aria-labelledby="h-usef-1" data-bs-parent="#acc-usef">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
python3 sendemail_BETA.py \
    --subject &quot;üê≥ Docker Container Report&quot; \
    --to_address &quot;replaceme@email.com&quot; \
    --mail_body_html &quot;&amp;nbsp;&quot; \
    --use_template &quot;UT_table_5col&quot; \
    --template_var &quot;$(docker ps --format '{{json .}}' \
| jq -cs '{col1:&quot;Name&quot;,col2:&quot;Image&quot;,col3:&quot;Status&quot;,col4:&quot;Ports&quot;,col5:&quot;ID&quot;,containers: map({col1:.Names,col2:.Image,col3:.Status,col4:.Ports,col5:.ID}) }')

</code> </pre>
                  </div>
                </div>
              </div>  
              
              <div class="accordion-item">
                <h2 class="accordion-header" id="h-usef-2">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-usef-2" aria-expanded="false" aria-controls="c-usef-2">
                    üîã Get a detailed UPS report
                  </button>
                </h2>
                <div id="c-usef-2" class="accordion-collapse collapse" aria-labelledby="h-usef-2" data-bs-parent="#acc-usef">
                  <div class="accordion-body">
                      <pre class="code mb-0"><code>#!/bin/bash
python3 sendemail_BETA.py \
    --subject &quot;üîã UPS Report&quot; \
    --to_address &quot;replaceme@email.com&quot; \
    --mail_body_html &quot;$(upsc *replaceme* | sed 's/$/&lt;br&gt;/')&quot; \
    --use_template &quot;UT_default&quot;
</code> </pre>
                  </div>
                </div>
              </div>                 

            </div>
          </section>          

        </div>


        <aside class="col-lg-2">
          <div class="position-sticky" style="top: 5.5rem;">
            <div class="card mb-3">
              <div class="card-body">
                <h3 class="h6 text-uppercase text-muted mb-3">Index</h3>
                <ol class="list-unstyled small">
                  <li><a href="#introduction" class="link-body-emphasis">About the project</a></li>
                  <li><a href="#advanced" class="link-body-emphasis">Advanced usage methods</a></li>
                  <li><a href="#updates" class="link-body-emphasis">Managing updates</a></li>
                  <li><a href="#usageexample" class="link-body-emphasis">Usage example</a></li>
                  <li><a href="#usefullsnipplet" class="link-body-emphasis">Usefull snipplet</a></li>
                </ol>
              </div>
            </div>
            <div class="card" style="display: none;">
              <div class="card-body">
                <h3 class="h6 text-uppercase text-muted mb-3">Resources</h3>
                <ul class="small mb-0">
                  <li>*</li>
                  <li>*</li>
                </ul>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </main>

  <!-- Modal -->
  <div class="modal fade" id="tplPreviewModal" tabindex="-1" aria-labelledby="tplPreviewLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="tplPreviewLabel">Template preview</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <img id="tplPreviewImg" src="" alt="" class="img-fluid rounded">
        </div>
      </div>
    </div>
  </div>

    <footer class="container py-4">
      <div class="d-flex flex-column flex-md-row align-items-center gap-2 justify-content-between">
        <small class="text-muted">¬© <span id="year"></span> <b>TrueNAS Stand-alone SendEmail</b> - provided with &lt;3 by Oxyde </small>
        <a href="#" id="scrollTopBtn" class="btn btn-outline-secondary btn-sm">Back to top ‚Üë</a>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
      document.getElementById('year').textContent = new Date().getFullYear();

      (function() {
        const root = document.documentElement;
        const buttons = document.querySelectorAll('[data-theme-value]');
        const pref = localStorage.getItem('theme') || 'auto';
        setTheme(pref);
        buttons.forEach(btn => btn.addEventListener('click', () => setTheme(btn.getAttribute('data-theme-value'))));
        function setTheme(val){
          localStorage.setItem('theme', val);
          if (val === 'auto') {
            root.setAttribute('data-bs-theme', window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
          } else {
            root.setAttribute('data-bs-theme', val);
          }
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
          if ((localStorage.getItem('theme') || 'auto') === 'auto') setTheme('auto');
        });
      })();

      document.getElementById('scrollTopBtn').addEventListener('click', e => {
        e.preventDefault();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });     

    document.getElementById('tplPreviewModal').addEventListener('show.bs.modal', function (event) {
      const trigger = event.relatedTarget;
      const full = trigger.getAttribute('data-full');
      const title = trigger.getAttribute('data-title') || 'Template preview';
      const img = this.querySelector('#tplPreviewImg');
      const label = this.querySelector('#tplPreviewLabel');
      img.src = full;
      img.alt = title;
      label.textContent = title;
    });      

    </script>
  </body>
</html>
